---
import { Image } from 'astro:assets';

export interface Props {
  post: any;
}

const { post } = Astro.props;

const slug = post.slug;
const postUrl = slug ? `/blog/${slug}` : null;

// CORREÇÃO DEFINITIVA: Acessa a URL da imagem no caminho correto revelado pela depuração.
const imageUrl = post.cover?.formats?.large?.url || post.cover?.url;
const imageWidth = post.cover?.formats?.large?.width || post.cover?.width;
const imageHeight = post.cover?.formats?.large?.height || post.cover?.height;

const title = post.title;
const excerpt = post.description;
const publishedAt = post.publishedAt;

const canRender = postUrl && title;
---

{canRender && (
  <a 
    href={postUrl} 
    class="group block bg-card rounded-lg shadow-md overflow-hidden transition-transform duration-300 transform hover:-translate-y-1 hover:shadow-xl border border-border post-card"
    data-published-at={publishedAt}  
  >
    {imageUrl && imageWidth && imageHeight ? (
      <div class="relative">
        <Image 
          src={imageUrl} 
          alt={title || 'Imagem do post'}
          width={imageWidth} 
          height={imageHeight} 
          format="webp" 
          quality={80}
          class="w-full h-48 object-cover"
        />
        <div class="absolute inset-0 bg-black bg-opacity-20 group-hover:bg-opacity-10 transition-all duration-300"></div>
      </div>
    ) : (
      <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
        <p class="text-gray-500">Sem Imagem</p>
      </div>
    )}
    <div class="p-6">
      <h3 class="text-xl font-bold font-montserrat text-card-foreground mb-2 group-hover:text-accent transition-colors duration-300">{title}</h3>
      {excerpt && (
        <p class="font-work-sans text-card-foreground/80 mb-4 h-20 overflow-hidden">{excerpt}</p>
      )}
      <span class="font-semibold text-accent">Leia mais →</span>
    </div>
  </a>
)}
