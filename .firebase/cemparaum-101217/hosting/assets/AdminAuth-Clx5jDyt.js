import{j as e,P as q,c as I,a as _,u as z,B as u,I as N}from"./index-Cl1cY7DK.js";import{r as n,e as F}from"./vendor-DRhANuH4.js";import{s as c,C,a as E,b as S,c as A,d as L}from"./card-DI2IjTCU.js";var M="Label",k=n.forwardRef((t,l)=>e.jsx(q.label,{...t,ref:l,onMouseDown:s=>{var o;s.target.closest("button, input, select, textarea")||((o=t.onMouseDown)==null||o.call(t,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));k.displayName=M;var R=k;const U=_("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),f=n.forwardRef(({className:t,...l},s)=>e.jsx(R,{ref:s,className:I(U(),t),...l}));f.displayName=R.displayName;const H=()=>{const[t,l]=n.useState(""),[s,m]=n.useState(""),[o,D]=n.useState(!0),[p,g]=n.useState(!1),[x,j]=n.useState(null),[V,w]=n.useState(null),{toast:d}=z(),h=F();n.useEffect(()=>{const{data:{subscription:i}}=c.auth.onAuthStateChange((a,r)=>{w(r),j((r==null?void 0:r.user)??null),r!=null&&r.user&&setTimeout(()=>{b(r.user.id)},0)});return c.auth.getSession().then(({data:{session:a}})=>{w(a),j((a==null?void 0:a.user)??null),a!=null&&a.user&&b(a.user.id)}),()=>i.unsubscribe()},[h]);const b=async i=>{try{const{data:a,error:r}=await c.from("admin_users").select("id").eq("user_id",i).single();a&&!r&&h("/admin/dashboard")}catch(a){console.error("Error checking admin status:",a)}},P=async i=>{i.preventDefault(),g(!0);try{if(o){const{error:a}=await c.auth.signInWithPassword({email:t,password:s});d(a?{title:"Erro no login",description:a.message,variant:"destructive"}:{title:"Login realizado com sucesso",description:"Redirecionando para o painel..."})}else{const a=`${window.location.origin}/admin/auth`,{data:r,error:v}=await c.auth.signUp({email:t,password:s,options:{emailRedirectTo:a}});if(v)d({title:"Erro no cadastro",description:v.message,variant:"destructive"});else if(r.user){const{error:y}=await c.from("admin_users").insert({user_id:r.user.id,email:t});y&&console.error("Error creating admin user:",y),d({title:"Cadastro realizado",description:"Verifique seu email para confirmar a conta."})}}}catch{d({title:"Erro",description:"Ocorreu um erro inesperado. Tente novamente.",variant:"destructive"})}finally{g(!1)}},T=async()=>{await c.auth.signOut(),l(""),m(""),d({title:"Logout realizado",description:"Você foi desconectado com sucesso."})};return x?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs(C,{className:"w-full max-w-md",children:[e.jsxs(E,{className:"text-center",children:[e.jsx(S,{children:"Painel Administrativo"}),e.jsxs(A,{children:["Logado como: ",x.email]})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsx(u,{onClick:()=>h("/admin/dashboard"),className:"w-full",children:"Acessar Dashboard"}),e.jsx(u,{onClick:T,variant:"outline",className:"w-full",children:"Sair"})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs(C,{className:"w-full max-w-md",children:[e.jsxs(E,{className:"text-center",children:[e.jsx(S,{children:"Admin - 100:1"}),e.jsx(A,{children:o?"Faça login para acessar o painel":"Crie uma conta de administrador"})]}),e.jsx(L,{children:e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"email",children:"Email"}),e.jsx(N,{id:"email",type:"email",value:t,onChange:i=>l(i.target.value),required:!0,placeholder:"admin@100para1.com.br"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"password",children:"Senha"}),e.jsx(N,{id:"password",type:"password",value:s,onChange:i=>m(i.target.value),required:!0,placeholder:"••••••••"})]}),e.jsx(u,{type:"submit",className:"w-full",disabled:p,children:p?"Carregando...":o?"Entrar":"Cadastrar"}),e.jsx(u,{type:"button",variant:"ghost",className:"w-full",onClick:()=>D(!o),children:o?"Criar conta de admin":"Já tenho conta"})]})})]})})};export{H as default};
