import{j as e,c as i,a as k,u as B,B as D}from"./index-xeMTXBAC.js";import{r as d,e as _}from"./vendor-DRhANuH4.js";import{s as u,C as H,a as L,b as V,c as F,d as q}from"./card-DOojqDh1.js";const p=d.forwardRef(({className:a,...r},s)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:s,className:i("w-full caption-bottom text-sm",a),...r})}));p.displayName="Table";const v=d.forwardRef(({className:a,...r},s)=>e.jsx("thead",{ref:s,className:i("[&_tr]:border-b",a),...r}));v.displayName="TableHeader";const N=d.forwardRef(({className:a,...r},s)=>e.jsx("tbody",{ref:s,className:i("[&_tr:last-child]:border-0",a),...r}));N.displayName="TableBody";const G=d.forwardRef(({className:a,...r},s)=>e.jsx("tfoot",{ref:s,className:i("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...r}));G.displayName="TableFooter";const x=d.forwardRef(({className:a,...r},s)=>e.jsx("tr",{ref:s,className:i("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",a),...r}));x.displayName="TableRow";const c=d.forwardRef(({className:a,...r},s)=>e.jsx("th",{ref:s,className:i("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...r}));c.displayName="TableHead";const l=d.forwardRef(({className:a,...r},s)=>e.jsx("td",{ref:s,className:i("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...r}));l.displayName="TableCell";const I=d.forwardRef(({className:a,...r},s)=>e.jsx("caption",{ref:s,className:i("mt-4 text-sm text-muted-foreground",a),...r}));I.displayName="TableCaption";const M=k("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function g({className:a,variant:r,...s}){return e.jsx("div",{className:i(M({variant:r}),a),...s})}const J=()=>{const[a,r]=d.useState(null),[s,f]=d.useState(null),[h,y]=d.useState([]),[w,T]=d.useState(!0),[C,R]=d.useState(!1),{toast:b}=B(),m=_();d.useEffect(()=>{const{data:{subscription:t}}=u.auth.onAuthStateChange((n,o)=>{f(o),r((o==null?void 0:o.user)??null),o!=null&&o.user?setTimeout(()=>{j(o.user.id)},0):m("/admin/auth")});return u.auth.getSession().then(({data:{session:n}})=>{f(n),r((n==null?void 0:n.user)??null),n!=null&&n.user?j(n.user.id):m("/admin/auth")}),()=>t.unsubscribe()},[m]);const j=async t=>{try{const{data:n,error:o}=await u.from("admin_users").select("id").eq("user_id",t).single();n&&!o?(R(!0),S()):(b({title:"Acesso negado",description:"Você não tem permissão para acessar esta área.",variant:"destructive"}),m("/admin/auth"))}catch(n){console.error("Error checking admin status:",n),m("/admin/auth")}finally{T(!1)}},S=async()=>{try{const{data:t,error:n}=await u.from("contacts").select("*").order("created_at",{ascending:!1});n?b({title:"Erro",description:"Não foi possível carregar os contatos.",variant:"destructive"}):y(t||[])}catch(t){console.error("Error loading contacts:",t)}},A=async()=>{await u.auth.signOut(),m("/admin/auth")},E=t=>new Date(t).toLocaleString("pt-BR");return w?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{children:"Carregando..."})}):C?e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard Administrativo"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie os contatos recebidos pelo site"})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Logado como: ",a==null?void 0:a.email]}),e.jsx(D,{onClick:A,variant:"outline",children:"Sair"})]})]}),e.jsxs(H,{children:[e.jsxs(L,{children:[e.jsx(V,{children:"Contatos Recebidos"}),e.jsxs(F,{children:["Total de ",h.length," contatos registrados"]})]}),e.jsx(q,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(p,{children:[e.jsx(v,{children:e.jsxs(x,{children:[e.jsx(c,{children:"Data"}),e.jsx(c,{children:"Nome"}),e.jsx(c,{children:"Email"}),e.jsx(c,{children:"Telefone"}),e.jsx(c,{children:"Empresa"}),e.jsx(c,{children:"Serviço"}),e.jsx(c,{children:"Mensagem"})]})}),e.jsxs(N,{children:[h.map(t=>e.jsxs(x,{children:[e.jsx(l,{className:"text-sm",children:E(t.created_at)}),e.jsx(l,{className:"font-medium",children:t.name}),e.jsx(l,{children:t.email}),e.jsx(l,{children:t.phone}),e.jsx(l,{children:t.company?e.jsx(g,{variant:"outline",children:t.company}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(l,{children:t.service?e.jsx(g,{variant:"secondary",children:t.service}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(l,{className:"max-w-xs truncate",title:t.message,children:t.message})]},t.id)),h.length===0&&e.jsx(x,{children:e.jsx(l,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"Nenhum contato registrado ainda."})})]})]})})})]})]})}):null};export{J as default};
